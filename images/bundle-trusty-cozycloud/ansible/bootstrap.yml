---
#
##
### Written by the CAT (Cloudwatt Automation Team)
##
#
- hosts: local
  user: cloud
  sudo: true

  tasks:

    - name: fr_FR locale present
      locale_gen: name="{{ item }}" state=present
      with_items:
        - fr_FR.UTF-8
        - en_US.UTF-8

    - name: apt-get update & upgrade
      apt:
        upgrade=full
        update_cache=yes
        cache_valid_time=3600

    - name: Config Key
      apt_key:
        url=https://ubuntu.cozycloud.cc/cozy.gpg.key
        state=present


    - name: Config Repo
      apt_repository:
        repo="deb https://ubuntu.cozycloud.cc/debian trusty main"
        update_cache=yes
        state=present

    - name: debconf rep create
      file:
        path=/root/debconf
        state=directory
        mode=0644

    - name: cp playbook postconf
      copy:
        src=Debconf-cozyinstall/debconf.yml
        dest=/root/debconf/debconf.yml
        owner=root
        group=root
        mode=0644

    - name: packages installed
      apt:
        pkg={{ item }}
        state=present

      with_items:
        - ca-certificates
        - apt-transport-https
        - cozy


