---
#
##
### Written by the CAT (Cloudwatt Automation Team)
##
#
- hosts: local
  user: cloud
  become: yes

  tasks:
    - name: apt-get update & upgrade
      apt: update_cache=yes upgrade=full

    - name: default sh is bash
      file: src=/bin/bash dest=/bin/sh state=link

    - name: packages installed
      apt: pkg={{ item }} state=present
      with_items:
        - openswan

    - name: configuration files uploaded
      copy:
        src=files/{{ item.file }}
        dest={{ item.path }}
        owner=root
        group=root
        mode=0644
      with_items:
        - { file: "etc_ipsec.conf",         path: "/etc/ipsec.conf" }
        - { file: "ipsec.secrets.manual",           path: "/etc/ipsec.secrets" }

