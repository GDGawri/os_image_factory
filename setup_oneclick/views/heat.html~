<div class="container-fluid" ng-controller="ContactController" ng-if="requiresAuth()">
    <ol class="breadcrumb">
        <li><a href="#/dashboard">Dashboard</a></li>
        <li><a href="#/tenants">Tenants</a></li>
        <li><a href="#/heat">Heat</a></li>
        <li ng-if="stack"><a href="#/heat/{{stack}}">{{stack}}</a></li>
    </ol>
    <h3>Heat Configuration</h3>
    <ul ng-if="!stack">
        <li><a href="#/heat/lamp">Linux Apache MySQL PHP (LAMP)</a></li>
        <li><a href="#/heat/mean">Mean</a></li>
        <li><a href="#/heat/Ghost">Ghost</a></li>
        <li><a href="#/heat/pgsql">Postgresql</a></li>
        <li><a href="#/heat/wordpress">Wordpress</a></li>
        <!--li><a href="#/heat/teamf2">Team Fortress 2 Game Server</a></li-->
    </ul>
    <hr>
    <div ng-if="heat">
        <form name="myForm" class="form-horizontal" role="form">
        	<div class="form-group">
            <label class="control-label col-sm-4 text-left" for="stack_name">Stack Name:</label>
            <div class="col-sm-8">
              <input type="text" ng-maxlength="64" ng-minlength="3" class="form-control" name="stack_name" id="stack_name" placeholder="Stack Name" title="The Stack name to start" ng-model="stack_name.value">
              <div class="help-block info">
                <div><b>Template Version:</b> {{ heat.descriptor.heat_template_version }}</div>
                <div><b>Description:</b> {{ heat.descriptor.description }}</div>
            </div>
            </div>
            </div>
            
        
            <fieldset ng-repeat="group in heat.guiGroups">
                <legend>{{group.label}}</legend>
                <div ng-if="group.description">{{group.description}}</div>
                <div class="form-group" ng-repeat="input in group.inputs">
                    <label class="control-label col-sm-4 text-left" for="{{ input.attributes.id }}">{{ input.attributes.label }}:</label>
                    <div class="col-sm-8">
                        <select class="form-control" ng-if="canListKeypairs && input.nodeType == 'input' && input.attributes.id == 'keypair_name'" name="{{ input.attributes.id }}" id="{{ input.attributes.id }}" title="{{ input.attributes.description }}" ng-model="input.attributes.value">
                            <option ng-repeat="val in refreshKeypairs().keypairs" title="{{val.keypair.fingerprint}}" ng-selected="val.keypair.name == input.attributes.value">{{ val.keypair.name }}</option>
                        </select>
                        <input type="{{input.attributes.type}}" ng-maxlength="{{input.attributes.maxLength}}" ng-minlength="{{input.attributes.minLength}}" class="form-control" ng-pattern="{{input.attributes.pattern}}" ng-if="input.nodeType == 'input' && (!canListKeypairs || input.attributes.id != 'keypair_name')" name="{{ input.attributes.id }}" id="{{ input.attributes.id }}" placeholder="{{ input.attributes.description }}" title="{{ input.attributes.description }}" ng-model="input.attributes.value" data-error="{{ input.attributes.dataErrors}}">
                        <textarea class="form-control" ng-maxlength="{{input.attributes.maxLength}}" ng-minlength="{{input.attributes.minLength}}" ng-if="input.nodeType == 'textarea'" name="{{ input.attributes.id }}" id="{{ input.attributes.id }}" placeholder="{{ input.attributes.description }}" title="{{ input.attributes.description }}" data-error="{{ input.attributes.dataError}}">{{ input.attributes.value}}</textarea>

                        <select class="form-control" ng-if="input.nodeType == 'select'" name="{{ input.attributes.id }}" id="{{ input.attributes.id }}" title="{{ input.attributes.description }}">
                            <option ng-repeat="val in input.possibleValues" ng-selected="val == input.attributes.value">{{ val }}</option>
                        </select>
                        <div ng-if="input.attributes.description" class="help-block info">{{input.attributes.description}}
                            <div class="error" ng-if="(myForm[input.attributes.id].$error.pattern || myForm[input.attributes.id].$error.required || myForm[input.attributes.id].$error.minLength || myForm[input.attributes.id].$error.maxLength)"><em ng-if="input.attributes.dataErrors">{{input.attributes.dataErrors}}</em>
                                <ul class="error">
                                    <li class="error" ng-show="myForm[input.attributes.id].$error.pattern">Field does not validate pattern !</li>
                                    <li class="error" ng-show="myForm[input.attributes.id].$error.required">Field is missing !</li>
                                    <li class="error" ng-show="myForm[input.attributes.id].$error.minlength">Field is too short !</li>
                                    <li class="error" ng-show="myForm[input.attributes.id].$error.maxlength">Field is too long !</li>
                                </ul>
                            </div>
                        </div>
                        <div ng-if="input.attributes.id == 'keypair_name'" class="help-block info"><a href="{{consolePublicUrl}}/project/access_and_security/?tab=access_security_tabs__keypairs_tab" target="_blank">Manage my keypairs&hellip; (SSH Keys)</a></div>
                    </div>
                </div>
            </fieldset>
            <div class="form-group">
                <ul class="error" ng-if="myForm.$error">
                    <li class="error" ng-show="myForm.$error.pattern">Some fields do not validate patterns !</li>
                    <li class="error" ng-show="myForm.$error.required">Some fields are missing !</li>
                    <li class="error" ng-show="myForm.$error.minLength">Some fields are too short !</li>
                    <li class="error" ng-show="myForm.$error.maxLength">Some fields are too long !</li>
                </ul>
            </div>
            <div class="form-group">
                <label for="tenantId" class="control-label col-sm-4 text-left">Tenant:</label>
                <div class="col-sm-8">
                <select id="tenantId" name="tenantId" ng-model="heatTenantId.id" required="required">
                  <option ng-repeat="t in listTenants().tenants" title="{{t.description}}" ng-selected="t.id == heatTenantId.id" value="{{t.id}}">{{t.name}}</option>
                </select>
                </div>
            </div>
            <div>
                
                <div ng-if="getScopedToken(heatTenantId.id)">
                    <pre><span ng-if="getScopedToken(heatTenantId.id)">curl -H Content-Type:application/json -H X-Auth-Token:{{(getScopedToken(heatTenantId.id)).access.token.id}} -XPOST {{extractHeatEndpoint()}}/stacks -d </span> '{{ recompute( heat.result) }}'</pre>
                    <input type="submit" ng-click="startStack()">
                    <div ng-if="refreshStacks()">
                    	<div ng-if="refreshStacks()">
                    		<h3>My Stacks</h3>
                    		<table class="table table-striped">
                <thead>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Creation Time</th>
                    <th>Description</th>
                </thead>
                <tbody>
                    <tr ng-repeat="s in refreshStacks().stacks">
                        <td title="{{s.id}}"><a target="_blank" href="{{consolePublicUrl}}/project/stacks/stack/{{s.id}}">{{ s.stack_name }}</a></td>
                        <td title="{{s.stack_status_reason}}">{{s.stack_status}}</td>
                        <td>
                            <time datetime="{{ s.creation_time }}">{{ s.creation_time | date : 'medium'}}</time>
                        </td>
                        <td>{{ s.description }}</td>
                    </tr>
                </tbody>
            </table>
                    	</div>
                    </div>
                </div>
                
            </div>
        </form>
                    <hr/>

    </div>
    <div> Cloudwatt Heat - Launch your stacks in ONE click !</div>
    <div>Copyrights 2015, Cloudwatt</div>
    <div>--</div>
</div>
